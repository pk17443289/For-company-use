# Google Sheets 設定指南

這份文件將詳細說明如何設定 Google Sheets 試算表。

## 📋 試算表結構

您的 Google Sheets 試算表需要包含以下三個工作表：

### 1. 員工資料（工作表名稱：員工資料）

**欄位說明：**

| 欄位 | 說明 | 範例 | 必填 |
|------|------|------|------|
| A - 員工編號 | 唯一的員工識別碼 | E001 | ✅ |
| B - 姓名 | 員工姓名 | 王小明 | ✅ |
| C - 部門 | 所屬部門 | 業務部 | ⭕ |
| D - 電話 | 聯絡電話 | 0912-345-678 | ⭕ |
| E - 建立時間 | 建立日期時間（自動填入） | 2025-01-15T10:30:00Z | 自動 |

**設定步驟：**
1. 建立新工作表，命名為「員工資料」
2. 在第一列（標題列）依序輸入：
   - A1: `員工編號`
   - B1: `姓名`
   - C1: `部門`
   - D1: `電話`
   - E1: `建立時間`

**範例資料：**
```
員工編號 | 姓名   | 部門   | 電話         | 建立時間
E001    | 王小明  | 業務部 | 0912-345-678| 2025-01-15T10:30:00Z
E002    | 李小華  | 客服部 | 0923-456-789| 2025-01-15T11:00:00Z
E003    | 張小美  | 行政部 | 0934-567-890| 2025-01-15T11:30:00Z
```

---

### 2. 打卡記錄（工作表名稱：打卡記錄）

**欄位說明：**

| 欄位 | 說明 | 範例 | 必填 |
|------|------|------|------|
| A - 日期 | 打卡日期 | 2025/1/15 | ✅ |
| B - 時間 | 打卡時間 | 09:05:30 | ✅ |
| C - 員工編號 | 打卡員工的編號 | E001 | ✅ |
| D - 員工姓名 | 打卡員工的姓名 | 王小明 | ✅ |
| E - 部門 | 員工所屬部門 | 業務部 | ⭕ |
| F - 類型 | check_in（上班）或 check_out（下班） | check_in | ✅ |
| G - 時間戳記 | ISO 格式時間戳記 | 2025-01-15T09:05:30Z | ✅ |

**設定步驟：**
1. 建立新工作表，命名為「打卡記錄」
2. 在第一列（標題列）依序輸入：
   - A1: `日期`
   - B1: `時間`
   - C1: `員工編號`
   - D1: `員工姓名`
   - E1: `部門`
   - F1: `類型`
   - G1: `時間戳記`

**範例資料：**
```
日期      | 時間     | 員工編號 | 員工姓名 | 部門   | 類型      | 時間戳記
2025/1/15| 09:05:30| E001    | 王小明   | 業務部 | check_in | 2025-01-15T09:05:30Z
2025/1/15| 18:10:00| E001    | 王小明   | 業務部 | check_out| 2025-01-15T18:10:00Z
2025/1/15| 09:02:15| E002    | 李小華   | 客服部 | check_in | 2025-01-15T09:02:15Z
```

---

### 3. 通知設定（工作表名稱：通知設定）【可選】

這個工作表可用於儲存通知相關的設定或記錄，目前為預留功能。

**欄位說明：**

| 欄位 | 說明 |
|------|------|
| A - 設定項目 | 設定的名稱 |
| B - 設定值 | 對應的值 |

**設定步驟：**
1. 建立新工作表，命名為「通知設定」
2. 在第一列輸入：
   - A1: `設定項目`
   - B1: `設定值`

**範例資料：**
```
設定項目           | 設定值
通知類型           | LINE
最後通知時間       | 2025-01-15 18:10:00
管理員信箱         | admin@example.com
```

---

## 🎯 快速設定範本

您可以複製以下連結的範本試算表（即將提供），或按照以下步驟手動建立：

### 方法一：使用範本（推薦）

1. 開啟範本連結：[PT 打卡系統範本](請自行建立)
2. 點選「檔案」→「建立副本」
3. 將副本儲存到您的 Google Drive
4. 完成！

### 方法二：手動建立

1. 前往 [Google Sheets](https://sheets.google.com)
2. 建立新試算表
3. 按照上述說明建立三個工作表
4. 設定標題列
5. 完成！

---

## ⚙️ 試算表權限設定

### 步驟 1：開啟共用設定

1. 點選試算表右上角的「共用」按鈕
2. 在「一般存取權」區域進行設定

### 步驟 2：選擇權限層級

**選項 A：僅供特定使用者（推薦）**
- 新增特定使用者的 Google 帳號
- 設定權限為「編輯者」
- 適合小團隊使用

**選項 B：任何知道連結的人**
- 選擇「知道連結的任何人」
- 設定權限為「編輯者」
- ⚠️ 注意：任何取得連結的人都可以存取

### 步驟 3：取得試算表 ID

從瀏覽器網址列複製試算表 ID：

```
https://docs.google.com/spreadsheets/d/[這段就是試算表ID]/edit
                                      ^^^^^^^^^^^^^^^^^^^^
```

例如：
```
https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
```
試算表 ID 就是：`1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms`

---

## 🔧 進階功能設定

### 資料驗證

您可以為某些欄位設定資料驗證，確保資料正確性：

**員工編號格式驗證：**
1. 選取「員工資料」工作表的 A 欄（員工編號）
2. 點選「資料」→「資料驗證」
3. 條件：自訂公式
4. 公式：`=REGEXMATCH(A2,"^E[0-9]{3}$")`
5. 這會確保員工編號格式為 E001、E002 等

**類型欄位驗證：**
1. 選取「打卡記錄」工作表的 F 欄（類型）
2. 點選「資料」→「資料驗證」
3. 條件：清單（從範圍）
4. 輸入：`check_in,check_out`

### 條件式格式設定

讓打卡記錄更容易閱讀：

**上班打卡顯示為綠色：**
1. 選取「打卡記錄」工作表的 F 欄
2. 點選「格式」→「條件式格式設定」
3. 格式設定規則：「文字包含」→ `check_in`
4. 格式樣式：綠色背景

**下班打卡顯示為藍色：**
1. 新增規則
2. 格式設定規則：「文字包含」→ `check_out`
3. 格式樣式：藍色背景

### 自動排序

設定自動按時間排序打卡記錄：

1. 選取「打卡記錄」工作表的所有資料
2. 點選「資料」→「建立篩選器」
3. 點選 G 欄（時間戳記）的篩選器圖示
4. 選擇「由 Z 到 A 排序」（最新的在上面）

---

## 📊 實用公式

在試算表中加入統計欄位：

### 今日出勤人數

在任意儲存格輸入：
```
=COUNTIFS(打卡記錄!A:A,TEXT(TODAY(),"yyyy/m/d"),打卡記錄!F:F,"check_in")
```

### 本月總出勤天數（特定員工）

```
=COUNTIFS(打卡記錄!C:C,"E001",打卡記錄!F:F,"check_in",打卡記錄!A:A,">="&TEXT(DATE(YEAR(TODAY()),MONTH(TODAY()),1),"yyyy/m/d"))
```

### 今日未打卡人數

```
=COUNTA(員工資料!A:A)-1-COUNTIFS(打卡記錄!A:A,TEXT(TODAY(),"yyyy/m/d"),打卡記錄!F:F,"check_in")
```

---

## ✅ 檢查清單

設定完成前，請確認：

- [ ] 已建立「員工資料」工作表並設定標題列
- [ ] 已建立「打卡記錄」工作表並設定標題列
- [ ] 已建立「通知設定」工作表並設定標題列
- [ ] 工作表名稱與 `config.js` 中的設定一致
- [ ] 試算表共用權限已正確設定
- [ ] 已複製試算表 ID 並填入 `config.js`
- [ ] 已測試在試算表中手動新增一筆員工資料
- [ ] 已在網站上測試讀取員工資料

---

## 🆘 疑難排解

**問題：無法讀取試算表資料**
- 檢查試算表 ID 是否正確
- 確認工作表名稱是否完全相同（大小寫、空格）
- 檢查共用權限是否已開啟

**問題：無法寫入資料到試算表**
- 確認共用權限設定為「編輯者」
- 檢查 Google Sheets API 是否已在 Google Cloud Console 中啟用

**問題：資料格式錯誤**
- 檢查標題列的欄位順序是否正確
- 確認沒有多餘的空白列或空白欄

---

完成設定後，您就可以開始使用 PT 打卡系統了！
