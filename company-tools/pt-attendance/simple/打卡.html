<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PT æ‰“å¡ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .time-display {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        .input-section {
            text-align: center;
        }

        .input-section h2 {
            color: #667eea;
            margin-bottom: 30px;
        }

        .input-section input {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            border: 3px solid #667eea;
            border-radius: 15px;
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 20px;
        }

        .input-section input:focus {
            outline: none;
            border-color: #5568d3;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .btn {
            padding: 15px 40px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .employee-info {
            background: #f0f9ff;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }

        .employee-info h2 {
            color: #667eea;
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .employee-info p {
            font-size: 1.3rem;
            color: #666;
            margin: 10px 0;
        }

        .today-records {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
        }

        .today-records h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .record-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 1.1rem;
        }

        .check-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 600px;
            margin: 30px auto;
        }

        .check-buttons button {
            padding: 40px 20px;
            font-size: 1.5rem;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .result {
            display: none;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 20px;
            animation: slideIn 0.5s;
        }

        .result.success {
            background: #d1fae5;
            color: #065f46;
        }

        .result.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .result .title {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .result .info {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .back-link {
            text-align: center;
            margin-top: 20px;
        }

        .back-link a {
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: inline-block;
            transition: all 0.3s;
        }

        .back-link a:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .check-buttons {
                grid-template-columns: 1fr;
            }

            .input-section input {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>â° PT æ‰“å¡ç³»çµ±</h1>
            <p>è«‹è¼¸å…¥å“¡å·¥ç·¨è™Ÿé€²è¡Œæ‰“å¡</p>
        </div>

        <div class="time-display" id="timeDisplay">è¼‰å…¥ä¸­...</div>

        <!-- è¼¸å…¥å€åŸŸ -->
        <div class="card" id="inputSection">
            <div class="input-section">
                <h2>è«‹è¼¸å…¥æ‚¨çš„å“¡å·¥ç·¨è™Ÿ</h2>
                <input type="text" id="empIdInput" placeholder="ä¾‹å¦‚ï¼šE001" autofocus>
                <br>
                <button class="btn" onclick="confirmEmployee()">ç¢ºèª</button>
            </div>
        </div>

        <!-- å“¡å·¥è³‡è¨Šèˆ‡æ‰“å¡æŒ‰éˆ• -->
        <div class="card" id="checkSection" style="display: none;">
            <div class="employee-info">
                <h2 id="empName"></h2>
                <p><strong>å“¡å·¥ç·¨è™Ÿï¼š</strong><span id="empId"></span></p>

                <div class="today-records" id="todayRecords"></div>
            </div>

            <div class="check-buttons">
                <button class="btn btn-success" onclick="checkIn()">
                    âœ… ä¸Šç­æ‰“å¡
                </button>
                <button class="btn btn-danger" onclick="checkOut()">
                    ğŸ‘‹ ä¸‹ç­æ‰“å¡
                </button>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-secondary" onclick="resetPage()">
                    ğŸ”„ é‡æ–°è¼¸å…¥
                </button>
            </div>
        </div>

        <!-- çµæœé¡¯ç¤º -->
        <div class="card result" id="resultArea"></div>

        <div class="back-link">
            <a href="index.html">â† è¿”å›ç®¡ç†é é¢</a>
        </div>
    </div>

    <script>
        // è¼‰å…¥è³‡æ–™
        let employees = JSON.parse(localStorage.getItem('employees') || '[]');
        let records = JSON.parse(localStorage.getItem('records') || '[]');
        let currentEmployee = null;

        // æ›´æ–°æ™‚é–“é¡¯ç¤º
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                weekday: 'short',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            document.getElementById('timeDisplay').textContent = timeStr;
        }

        // ç¢ºèªå“¡å·¥
        function confirmEmployee() {
            const empId = document.getElementById('empIdInput').value.trim();

            if (!empId) {
                alert('è«‹è¼¸å…¥å“¡å·¥ç·¨è™Ÿ');
                return;
            }

            const emp = employees.find(e => e.id === empId);

            if (!emp) {
                alert('æ‰¾ä¸åˆ°æ­¤å“¡å·¥\nè«‹ç¢ºèªç·¨è™Ÿæ˜¯å¦æ­£ç¢ºï¼š' + empId);
                return;
            }

            // å„²å­˜ç•¶å‰å“¡å·¥
            currentEmployee = emp;

            // é¡¯ç¤ºå“¡å·¥è³‡è¨Š
            document.getElementById('empName').textContent = emp.name;
            document.getElementById('empId').textContent = emp.id;

            // é¡¯ç¤ºä»Šæ—¥æ‰“å¡è¨˜éŒ„
            loadTodayRecords(emp.id);

            // åˆ‡æ›é¡¯ç¤º
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('checkSection').style.display = 'block';
        }

        // è¼‰å…¥ä»Šæ—¥æ‰“å¡è¨˜éŒ„
        function loadTodayRecords(empId) {
            const today = new Date().toLocaleDateString('zh-TW');
            const todayRecords = records.filter(r => r.empId === empId && r.date === today);

            const container = document.getElementById('todayRecords');

            if (todayRecords.length === 0) {
                container.innerHTML = '<p style="color: #999;">ä»Šæ—¥å°šæœªæ‰“å¡</p>';
            } else {
                container.innerHTML = '<h3>ä»Šæ—¥æ‰“å¡è¨˜éŒ„</h3>';
                todayRecords.forEach(record => {
                    const type = record.type === 'in' ? 'ä¸Šç­' : 'ä¸‹ç­';
                    const icon = record.type === 'in' ? 'âœ…' : 'ğŸ‘‹';
                    container.innerHTML += `
                        <div class="record-item">
                            ${icon} ${type}æ‰“å¡ï¼š${record.time}
                        </div>
                    `;
                });
            }
        }

        // ä¸Šç­æ‰“å¡
        function checkIn() {
            recordAttendance('in', 'ä¸Šç­');
        }

        // ä¸‹ç­æ‰“å¡
        function checkOut() {
            recordAttendance('out', 'ä¸‹ç­');
        }

        // è¨˜éŒ„æ‰“å¡
        function recordAttendance(type, typeName) {
            if (!currentEmployee) return;

            const now = new Date();
            const record = {
                empName: currentEmployee.name,
                empId: currentEmployee.id,
                type: type,
                date: now.toLocaleDateString('zh-TW'),
                time: now.toLocaleTimeString('zh-TW', { hour12: false }),
                timestamp: now.getTime()
            };

            records.push(record);
            localStorage.setItem('records', JSON.stringify(records));

            // é¡¯ç¤ºçµæœ
            showResult(
                `${type === 'in' ? 'âœ…' : 'ğŸ‘‹'} ${typeName}æ‰“å¡æˆåŠŸï¼`,
                `${currentEmployee.name}<br>${record.date} ${record.time}`,
                'success'
            );
        }

        // é¡¯ç¤ºçµæœ
        function showResult(title, message, resultType) {
            const resultArea = document.getElementById('resultArea');
            const checkSection = document.getElementById('checkSection');

            resultArea.className = `card result ${resultType}`;
            resultArea.innerHTML = `
                <div class="title">${title}</div>
                <div class="info">${message}</div>
                <button class="btn btn-secondary" onclick="resetPage()">ğŸ”„ ç¹¼çºŒæ‰“å¡</button>
            `;

            checkSection.style.display = 'none';
            resultArea.style.display = 'block';

            // 3ç§’å¾Œè‡ªå‹•é‡ç½®
            setTimeout(resetPage, 3000);
        }

        // é‡ç½®é é¢
        function resetPage() {
            currentEmployee = null;
            document.getElementById('empIdInput').value = '';
            document.getElementById('inputSection').style.display = 'block';
            document.getElementById('checkSection').style.display = 'none';
            document.getElementById('resultArea').style.display = 'none';
            document.getElementById('empIdInput').focus();
        }

        // åˆå§‹åŒ–
        updateTime();
        setInterval(updateTime, 1000);

        // Enter éµæ”¯æ´
        document.getElementById('empIdInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmEmployee();
            }
        });

        // æª¢æŸ¥æ˜¯å¦æœ‰å“¡å·¥è³‡æ–™
        if (employees.length === 0) {
            alert('å°šæœªæ–°å¢ä»»ä½•å“¡å·¥\nè«‹å…ˆåˆ°ç®¡ç†é é¢æ–°å¢å“¡å·¥');
        }

        // æª¢æŸ¥ç¶²å€åƒæ•¸ï¼ˆQR Code æƒæï¼‰
        const urlParams = new URLSearchParams(window.location.search);
        const empIdFromUrl = urlParams.get('id');
        if (empIdFromUrl) {
            // è‡ªå‹•å¡«å…¥å“¡å·¥ç·¨è™Ÿä¸¦ç¢ºèª
            document.getElementById('empIdInput').value = empIdFromUrl;
            confirmEmployee();
        }
    </script>
</body>
</html>
