# 📋 耗材盤點表 - Google Sheets 整合設定說明

## 🎯 功能說明

這個盤點表系統會：
1. ✅ **簡化盤點流程** - 只需選擇「充足」、「需要補貨」或「緊急補貨」
2. ✅ **顯示上次盤點狀態** - 讓盤點人員參考
3. ✅ **自動比對差異** - 如果與上次狀態不同會警告
4. ✅ **記錄到 Google Sheets** - 保留完整歷史記錄
5. ✅ **匯出 CSV 備份** - 本地也有一份資料

---

## 📝 設定步驟（大約 10 分鐘）

### 第一步：建立 Google Sheets 試算表

1. 前往 [Google Sheets](https://sheets.google.com)
2. 點擊「空白」建立新試算表
3. 將試算表重新命名為「耗材盤點記錄」
4. 複製試算表網址中的 **ID**
   - 例如網址：`https://docs.google.com/spreadsheets/d/1ABC123XYZ456/edit`
   - ID 就是：`1ABC123XYZ456`
   - **記下這個 ID，稍後會用到**

---

### 第二步：設定 Google Apps Script

1. 在試算表中，點擊上方選單「**擴充功能**」→「**Apps Script**」

2. 會開啟一個新的程式碼編輯器視窗

3. 刪除預設的程式碼，貼上 `Google_Apps_Script.gs` 檔案中的所有程式碼

4. **重要！** 找到第 6 行：
   ```javascript
   const SPREADSHEET_ID = '你的試算表ID';
   ```
   把 `你的試算表ID` 改成你剛才記下的 ID，例如：
   ```javascript
   const SPREADSHEET_ID = '1ABC123XYZ456';
   ```

5. 點擊上方的「**儲存**」圖示（磁片圖案）

6. 將專案命名為「耗材盤點表 API」

---

### 第三步：部署為網路應用程式

1. 點擊右上角的「**部署**」按鈕 → 選擇「**新增部署作業**」

2. 在左側點擊「**選取類型**」→ 選擇「**網路應用程式**」

3. 設定如下：
   - **說明**：輸入「耗材盤點表 v1」
   - **執行身分**：選擇「**我**」
   - **具有存取權的使用者**：選擇「**所有人**」

   ⚠️ **重要**：一定要選「所有人」，否則前端無法存取

4. 點擊「**部署**」

5. 第一次部署會要求授權：
   - 點擊「**授權存取權**」
   - 選擇你的 Google 帳號
   - 點擊「**進階**」→「**前往『耗材盤點表 API』(不安全)」**
   - 點擊「**允許**」

6. 部署成功後，會顯示一個「**網路應用程式網址**」
   - 網址格式類似：`https://script.google.com/macros/s/AKfycby.../exec`
   - **複製這個完整網址，非常重要！**

---

### 第四步：設定前端程式碼

1. 開啟 `script.js` 檔案

2. 找到第 2 行：
   ```javascript
   const GOOGLE_SCRIPT_URL = ''; // 這裡填入你的 Google Apps Script 網址
   ```

3. 把剛才複製的網址貼上，例如：
   ```javascript
   const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby.../exec';
   ```

4. 儲存檔案

---

### 第五步：測試

1. 開啟 `index.html`

2. 填寫盤點資料

3. 點擊「✅ 提交盤點表」

4. 檢查 Google Sheets 試算表：
   - **盤點記錄** 工作表：應該有完整的歷史記錄
   - **最新庫存** 工作表：應該有最新的庫存數量

5. 重新整理網頁，應該會看到每個項目旁邊顯示「上次盤點：XX」

---

## 🎨 介面說明

### 盤點方式
每個項目有兩個大按鈕，只需點選其中一個：
- **✅ 不用叫貨** - 綠色，庫存充足
- **⚠️ 要叫貨** - 黃色，需要叫貨

### 顏色標示
- **黃底紅字** - 補貨標準（例如：⚠️ 剩兩台就要叫）
- **藍色標籤** - 上次盤點狀態（供參考）
- **綠色背景** - 已選擇「不用叫貨」
- **黃色背景** - 已選擇「要叫貨」或整個項目需要叫貨
- **橘色背景 + 🔄** - 與上次盤點狀態不同

### 狀態變更警告機制
當你選擇的狀態與上次盤點不同時：
1. 項目會顯示橘色背景和「🔄 狀態變更」標籤
2. 提交時會彈出確認視窗，列出所有狀態變更的項目
3. 你可以選擇：
   - 取消提交，重新檢查狀態
   - 確認提交（如果狀態確實改變）

---

## 📊 Google Sheets 資料結構

### 「盤點記錄」工作表
記錄每次盤點的完整歷史，永久保存：
- 提交時間
- 盤點日期
- 盤點人員
- 分類
- 項目名稱
- 狀態（不用叫貨/要叫貨）
- 項目鍵值

### 「最新庫存」工作表
只保留最新一次的盤點狀態，供下次盤點參考：
- 項目鍵值
- 分類
- 項目名稱
- 狀態（不用叫貨/要叫貨）
- 盤點日期
- 盤點人員
- 更新時間

---

## 🔧 常見問題

### Q1: 提交時顯示「未設定 Google Sheets URL」
**A**: 請確認 `script.js` 第 2 行的 `GOOGLE_SCRIPT_URL` 已填入正確的網址

### Q2: 提交後 Google Sheets 沒有資料
**A**: 檢查：
1. Apps Script 是否正確部署為「網路應用程式」
2. 「具有存取權的使用者」是否選擇「所有人」
3. SPREADSHEET_ID 是否正確
4. 瀏覽器的開發者工具（F12）的 Console 是否有錯誤訊息

### Q3: 沒有顯示「上次盤點」資料
**A**:
1. 第一次使用時不會有上次盤點資料，這是正常的
2. 至少要提交過一次盤點後，下次才會顯示
3. 重新整理網頁確認是否已載入

### Q4: 如何更新 Apps Script 程式碼？
**A**:
1. 修改程式碼後點擊「儲存」
2. 點擊「部署」→「管理部署作業」
3. 點擊現有部署右側的「編輯」圖示
4. 在「版本」下拉選單選擇「新增版本」
5. 點擊「部署」

### Q5: 如果不想要狀態變更警告怎麼辦？
**A**: 可以關閉！在 `script.js` 找到這段程式碼（約第 499-509 行）：
```javascript
// 檢查是否有狀態變更的項目
const changedItems = document.querySelectorAll('.item-row.status-changed');
if (changedItems.length > 0) {
    // ... 警告程式碼
}
```
把這整段程式碼註解掉或刪除即可。

---

## 📞 技術支援

如有任何問題，請聯繫系統管理員或查看 Google Apps Script 的執行記錄。

---

## 🎉 完成！

設定完成後，你的盤點系統就能：
- ✅ 簡化盤點流程，只需點選狀態
- ✅ 自動記錄所有盤點歷史到 Google Sheets
- ✅ 顯示上次盤點狀態供參考
- ✅ 自動警告狀態變更的項目
- ✅ 匯出 CSV 備份檔案

讓盤點工作更快速、更簡單、更有效率！
