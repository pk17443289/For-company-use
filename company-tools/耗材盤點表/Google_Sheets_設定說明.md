# 耗材盤點表 - Google Sheets 連接設定說明

## 步驟一：建立 Google Sheets

1. 前往 [Google Sheets](https://sheets.google.com)
2. 點選「空白」建立新試算表
3. 將試算表命名為「耗材盤點資料」（或您喜歡的名稱）

## 步驟二：建立 Apps Script

1. 在試算表中，點選上方選單「擴充功能」>「Apps Script」
2. 這會開啟一個新的 Apps Script 編輯器視窗
3. 刪除預設的程式碼
4. 將 `GoogleAppsScript.gs` 檔案中的全部程式碼複製貼上
5. 點選上方的「儲存」按鈕（或按 Ctrl+S）
6. 將專案命名為「耗材盤點」

## 步驟三：初始化試算表

1. 在 Apps Script 編輯器中，點選上方的函數下拉選單
2. 選擇 `initializeSpreadsheet`
3. 點選「執行」按鈕
4. 首次執行會要求授權，點選「審查權限」
5. 選擇您的 Google 帳號
6. 點選「進階」>「前往 耗材盤點（不安全）」
7. 點選「允許」
8. 執行成功後，試算表會自動建立以下工作表：
   - **最新狀態**：儲存每個項目的最新盤點狀態
   - **盤點歷史**：完整的盤點紀錄
   - **盤點摘要**：每次盤點的統計摘要
   - **待採購**：需要叫貨的項目清單

## 步驟四：部署為網頁應用程式

1. 在 Apps Script 編輯器中，點選右上角的「部署」>「新增部署作業」
2. 點選齒輪圖示，選擇「網頁應用程式」
3. 設定：
   - **說明**：耗材盤點 API（或任意說明）
   - **執行身分**：我
   - **誰可以存取**：任何人
4. 點選「部署」
5. 複製顯示的「網頁應用程式網址」

## 步驟五：連接到盤點表網頁

1. 開啟 `script.js` 檔案
2. 找到第 2 行：
   ```javascript
   const GOOGLE_SCRIPT_URL = '';
   ```
3. 將複製的網址貼上：
   ```javascript
   const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/xxxxxx/exec';
   ```
4. 儲存檔案

## 完成！

現在盤點表網頁已經連接到 Google Sheets：
- 開啟網頁時會自動載入上次的盤點狀態
- 提交盤點表會自動儲存到試算表
- 補貨狀態會正確追蹤

## 工作表說明

### 最新狀態
| 欄位 | 說明 |
|------|------|
| 項目Key | 項目的唯一識別碼（如 ajun-0, warehouse-5） |
| 狀態 | 不用叫貨 / 要叫貨 / 補貨中 / 已補貨 |
| 更新時間 | 最後更新時間 |

### 盤點歷史
| 欄位 | 說明 |
|------|------|
| 時間戳記 | 提交時間 |
| 盤點日期 | 選擇的盤點日期 |
| 盤點人員 | 執行盤點的人員 |
| 分類 | 項目分類 |
| 項目名稱 | 項目名稱 |
| 狀態 | 盤點狀態 |

### 盤點摘要
| 欄位 | 說明 |
|------|------|
| 時間戳記 | 提交時間 |
| 盤點日期 | 選擇的盤點日期 |
| 盤點人員 | 執行盤點的人員 |
| 總項目 | 盤點項目總數 |
| 要叫貨 | 要叫貨的項目數 |
| 不用叫貨 | 不用叫貨的項目數 |
| 補貨中 | 補貨中的項目數 |
| 已補貨 | 已補貨的項目數 |

### 待採購
| 欄位 | 說明 |
|------|------|
| 加入時間 | 加入待採購的時間 |
| 盤點日期 | 盤點日期 |
| 盤點人員 | 盤點人員 |
| 分類 | 項目分類 |
| 項目名稱 | 需要採購的項目 |

## 注意事項

1. **每次修改 Apps Script 程式碼後**，需要重新部署：
   - 點選「部署」>「管理部署作業」
   - 點選編輯圖示（鉛筆）
   - 版本選擇「新版本」
   - 點選「部署」

2. **如果遇到 CORS 錯誤**，確認部署設定中「誰可以存取」設為「任何人」

3. **資料安全**：此設定允許任何知道網址的人存取 API，如果需要更高安全性，可以加入驗證機制
