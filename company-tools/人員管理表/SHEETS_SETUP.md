# Google Sheets 設定說明

本系統支援與 Google Sheets 同步，讓資料可以跨裝置使用並支援多人協作。

## 步驟 1：建立 Google 試算表

1. 前往 [Google Sheets](https://sheets.google.com/)
2. 建立新的試算表，命名為「人員管理表」
3. 建立三個工作表（Sheet）：
   - `人員資料`
   - `任務列表`
   - `歷史記錄`

### 人員資料工作表格式

在 `人員資料` 工作表中，建立以下欄位（第一列為標題）：

| ID | 姓名 | 職位等級 | 聯絡方式 |
|----|------|---------|---------|
| 1  | 王大明 | 9 | 分機101 |
| 2  | 李小華 | 7 | 分機102 |

### 任務列表工作表格式

在 `任務列表` 工作表中，建立以下欄位：

| ID | 任務名稱 | 類型 | 開始時 | 結束時 | 負責人ID | 說明 |
|----|---------|------|--------|--------|----------|------|
| 1  | 早晨巡視 | daily | 8 | 9 | 5 | 檢查場地狀況 |
| 2  | 重要會議 | important | 10 | 12 | 1 | 主管會議 |

### 歷史記錄工作表格式

在 `歷史記錄` 工作表中，建立以下欄位：

| 時間 | 動作 |
|------|------|
| 2025/1/1 09:00 | 新增人員: 王大明 |
| 2025/1/1 09:05 | 新增任務: 早晨巡視 |

## 步驟 2：取得 Google Sheets API 金鑰

### 2.1 建立 Google Cloud 專案

1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 建立新專案，或選擇現有專案
3. 在左側選單中，選擇「API 和服務」>「資訊主頁」

### 2.2 啟用 Google Sheets API

1. 點擊「+ 啟用 API 和服務」
2. 搜尋「Google Sheets API」
3. 點擊並啟用

### 2.3 建立 API 金鑰

1. 在左側選單中，選擇「憑證」
2. 點擊「+ 建立憑證」>「API 金鑰」
3. 複製產生的 API 金鑰
4. （建議）點擊「限制金鑰」，只允許「Google Sheets API」

## 步驟 3：取得試算表 ID

1. 開啟你建立的 Google 試算表
2. 查看網址，格式如下：
   ```
   https://docs.google.com/spreadsheets/d/YOUR_SPREADSHEET_ID/edit
   ```
3. 複製 `YOUR_SPREADSHEET_ID` 部分

## 步驟 4：設定系統

1. 開啟 `config.js` 檔案
2. 填入你的 API 金鑰和試算表 ID：

```javascript
const CONFIG = {
    USE_LOCAL_STORAGE: false,  // 改為 false 使用 Google Sheets
    API_KEY: '你的API金鑰',
    SPREADSHEET_ID: '你的試算表ID',

    SHEETS: {
        PERSONNEL: '人員資料',
        TASKS: '任務列表',
        HISTORY: '歷史記錄'
    }
};
```

3. 儲存檔案

## 步驟 5：設定試算表權限

1. 開啟你的 Google 試算表
2. 點擊右上角的「共用」按鈕
3. 在「取得連結」區域，將權限設為：
   - **檢視者**：如果只需要從網頁讀取資料
   - **編輯者**：如果需要從網頁寫入資料（建議）
4. 點擊「複製連結」

## 使用同步功能

設定完成後：

1. 開啟 `index.html`
2. 點擊頂部的「同步資料」按鈕
3. 系統會自動與 Google Sheets 同步

### 同步規則

- 首次同步時，如果試算表是空的，會將本地資料寫入試算表
- 之後的同步會以試算表資料為主，覆蓋本地資料
- 歷史記錄只會寫入試算表，不會讀取

## 注意事項

### 安全性

- **不要**將包含 API 金鑰的 `config.js` 上傳到公開的 Git 倉庫
- 建議使用 API 金鑰限制，只允許特定 API 使用
- 如果 API 金鑰外洩，請立即在 Google Cloud Console 中刪除並重新建立

### 本地與雲端模式切換

- 本地模式：資料存在瀏覽器 localStorage，快速但無法跨裝置
- 雲端模式：資料存在 Google Sheets，可跨裝置但需要網路連線

在 `config.js` 中設定 `USE_LOCAL_STORAGE` 來切換模式。

## 疑難排解

### 同步失敗：403 錯誤

- 檢查 API 金鑰是否正確
- 確認已啟用 Google Sheets API
- 確認試算表權限設定正確

### 同步失敗：404 錯誤

- 檢查試算表 ID 是否正確
- 確認工作表名稱是否正確（區分大小寫）

### 資料未更新

- 按 F12 開啟開發者工具，查看 Console 是否有錯誤訊息
- 確認網路連線正常
- 嘗試重新整理頁面後再同步

## 進階設定

如需更複雜的同步邏輯（如自動同步、衝突解決等），請參考 `config.example.js` 中的範例程式碼，並根據需求修改。
